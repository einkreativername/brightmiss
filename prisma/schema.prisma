// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  SUB
}

model User {
  id          String    @id @default(uuid())
  email       String    @unique
  password    String?   // Nullable for invited users
  name        String
  role        Role      @default(SUB)
  isInvited   Boolean   @default(false)
  inviteToken String?   @unique
  lastLogin   DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  profile      UserProfile?
  inviteTokens InviteToken[]

  @@index([email])
}

model UserProfile {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Personal Information
  firstName   String?  @db.VarChar(100)
  lastName    String?  @db.VarChar(100)
  dateOfBirth DateTime?
  bio         String?  @db.Text

  // Contact Information
  phone      String?
  address    String?
  city       String?
  postalCode String?
  country    String?
  workPlace  String?

  // JSON Fields
  emergencyContacts Json?
  socialMedia       Json?

  // Media
  profileImage  String?
  coverImage    String?
  galleryImages String[]
  videos        String[]

  // Phase 1 - Identity
  fullLegalName  String?
  secondaryPhone String?
  privateEmail   String?
  cloudEmail     String?
  idNumber       String?
  licensePlate   String?

  // Phase 2 - Digital & Financial
  paymentDetails    String?
  amazonWishlist    String?
  remoteControlId   String?
  streamingAccounts Json?
  mobileDevice      String?

  // Phase 3 - Vault
  vaultImages          String[]
  vaultVideos          String[]
  idCardImages         String[]
  declarationImage     String?
  declarationFaceImage String?

  // Profile Locking System
  changeRequested Boolean @default(false)

  // First Name Locking
  firstNameApproved Boolean  @default(false)
  firstNameLocked   Boolean  @default(false)
  firstNamePending  String?  @db.VarChar(100)

  // Last Name Locking
  lastNameApproved Boolean  @default(false)
  lastNameLocked   Boolean  @default(false)
  lastNamePending  String?  @db.VarChar(100)

  // Phone Locking
  phoneApproved Boolean @default(false)
  phoneLocked   Boolean @default(false)
  phonePending  String?

  // Address Locking
  addressApproved Boolean @default(false)
  addressLocked   Boolean @default(false)
  addressPending  String?

  // Work Place Locking
  workPlaceApproved Boolean @default(false)
  workPlaceLocked   Boolean @default(false)
  workPlacePending  String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

model InviteToken {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([token])
  @@index([userId])
}
